"""Litestar application factory."""

from litestar import Litestar, get
from litestar.openapi import OpenAPIConfig

from app.config import settings
{% if has_advanced_alchemy %}
from advanced_alchemy.exceptions import RepositoryError
from app.config import alchemy
from app.lib import exception_handler
{% endif %}


@get("/")
async def index() -> dict[str, str]:
    """Root endpoint."""
    return {"message": "Hello, World!", "app": settings.APP_NAME}


@get("/health")
async def health() -> dict[str, str]:
    """Health check endpoint."""
    return {"status": "healthy"}


app = Litestar(
    route_handlers=[index, health],
    openapi_config=OpenAPIConfig(
        title=settings.APP_NAME,
        version="0.1.0",
        path="/api",
    ),
    debug=settings.DEBUG,
{% if has_advanced_alchemy %}
    exception_handlers={
        Exception: exception_handler,
        RepositoryError: exception_handler,
    },
    plugins=[alchemy],
{% endif %}
)
